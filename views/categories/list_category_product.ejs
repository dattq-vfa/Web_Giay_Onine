<div class="main_content">
  <div class="row" style="padding-bottom: 10px;">
    <div class="col-md-5">
      <a href="list_categories" class="btn btn-primary"><i class="fa fa-arrow-circle-left" style="font-size:24px"></i> </a>
      <a href="list_categories/list_delete" class="btn btn-warning"><i class="fa fa-trash-o" style="font-size:24px"></i> List deleted</a>
      <button class="btn btn-primary" data-toggle="modal" data-target="#myModal"><i class="fa fa-plus" style="font-size:20px"></i> Add Category</button>
    </div>
    <div class="col-md-7">
      <form class="form-inline justify-content-end" id="btn_search">
          <input class="form-control mr-sm-2" type="text" placeholder="Search" id="text_search">
          <button class="btn btn-success" type="submit">Search</button>
      </form>
    </div>
</div>
<table class="table table-dark table-hover" id="table_category">
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Group</th>
      <th>Image</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Describe</th>
      <th></th>
    </tr>
  </thead>
  <tbody id="table">
    <%- str%>
  </tbody>
</table>
  <ul class="pagination justify-content-end">
    <li class="page-item active"><a class="page-link" href="#">Previous</a></li>
    <li class="page-item"><a class="page-link" href="#">1</a></li>
    <li class="page-item"><a class="page-link" href="#">2</a></li>
    <li class="page-item"><a class="page-link" href="#">Next</a></li>
  </ul>
</div>

<!------------------------------ The Modal --------------------------------->
<!-----------------ADD Modal --------------------------->
<div class="modal" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Add Product</h4>
        <span type="button" class="close" data-dismiss="modal">&times;</span>
      </div>
      <!-- //enctype="multipart/form-data" very important -->
      <form id="upload_img" method="POST" enctype="multipart/form-data">
          <!-- Modal body -->   
          <div class="modal-body">
            <div class="form-group">
              <div class="dropdown form-group">
                <label for="TYPE" class="group" style="font-weight: bold;">Type: 
                  <select id="TYPE" name="TYPE" class="btn btn-primary">
                    <option value="Boy">Boy</option>
                    <option value="Girl">Girl</option>
                    <option value="Child">Child</option>
                    <option value="Other">Other</option>
                  </select>
                <label>
                <label for="Group" class="group" style="font-weight: bold; padding-left: 10px;">Group: 
                  <select id="Group" name="Group" class="btn btn-primary ">
                    <option value="Classic">Classic</option>
                    <option value="One Star">One Star</option>
                  </select>
                </label>
              </div>
              <b>Name Product:</b>
              <input class="form-control" id="name" name="name" placeholder="Name Product..." type="text" required>
              <b>Price:</b>
              <input class="form-control" id="price" name="price" placeholder="Price..." type="number" required>
              <b>Quantity:</b>
              <input class="form-control" id="quantity" name="quantity" placeholder="Quantity..." type="number" required>
              <b>Avatar Image:</b> (Format: .jpg .png)
              <input type="file" class="form-control" id="img" name="img" accept=".jpg,.png" >
              <b>Items Image:</b> (Format: .jpg .png)
              <!-- multiple neu input nhieu file -->
              <input type="file" class="form-control" id="imgs" name="imgs"  accept=".jpg,.png" multiple>
              <b>Describe:</b>
              <textarea  class="form-group" name="content" id="content"></textarea>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
              <button type="submit" class="btn btn-success"><i class="fa fa-upload"></i> Upload</button>
              <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancel</button>
            </div>
          </div>
      </form> 
    </div>
  </div>
</div>
<!-----------------ADD Modal --------------------------->

<!-----------------EDIT Modal --------------------------->
<div class="modal" id="myModaledit">
  <div class="modal-dialog">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Edit Product</h4>
        <span type="button" class="close" data-dismiss="modal">&times;</span>
      </div>
      <!-- //enctype="multipart/form-data" very important -->
      <form id="e_upload_img" method="POST" enctype="multipart/form-data">
          <!-- Modal body -->   
          <div class="modal-body">
            <div class="form-group">
              <div class="dropdown form-group">
                <label for="TYPE" class="group" style="font-weight: bold;">Type: 
                  <select id="e_TYPE" name="TYPE" class="btn btn-primary">
                    <option value="Boy">Boy</option>
                    <option value="Girl">Girl</option>
                    <option value="Child">Child</option>
                    <option value="Other">Other</option>
                  </select>
                <label>
                <label for="Group" class="group" style="font-weight: bold; padding-left: 10px;">Group: 
                  <select id="e_Group" name="Group" class="btn btn-primary ">
                    <option value="Classic">Classic</option>
                    <option value="One Star">One Star</option>
                  </select>
                </label>
              </div>
              <b>Name Product:</b>
              <input class="form-control" id="e_name" name="name" placeholder="Name Product..." type="text" required>
              <b>Price:</b>
              <input class="form-control" id="e_price" name="price" placeholder="Price..." type="number" required>
              <b>Quantity:</b>
              <input class="form-control" id="e_quantity" name="quantity" placeholder="Quantity..." type="number" required>
              <b>Avatar Image:</b> (Format: .jpg .png)
              <input type="file" class="form-control" id="e_img" name="img" accept=".jpg,.png" >
              <span id="show_img"></span>
              <div><b>Items Image:</b> (Format: .jpg .png)</div>
              <!-- multiple neu input nhieu file -->
              <input type="file" class="form-control" id="e_imgs" name="imgs"  accept=".jpg,.png" multiple>
              <span id="show_imgs"></span>
              <div><b>Describe:</b></div>
              <textarea  class="form-group" name="content" id="contents"></textarea>
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
              <button type="submit" class="btn btn-success"><i class="fa fa-upload"></i> Upload</button>
              <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancel</button>
            </div>
          </div>
      </form> 
    </div>
  </div>
</div>
<!-----------------EDIT Modal --------------------------->

<!-----------------DELETE Temporary Modal --------------------------->
<div class="modal" id="myModal-delete-tmp">
  <div class="modal-dialog">
      <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
              <h4 class="modal-title">Thông báo</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <!-- Modal body -->
          <div class="modal-body">
              Bạn có muốn xóa <span id="f_delete_name_tmp"></span> không?
          </div>
          <!-- Modal footer -->
          <div class="modal-footer">
              <button type="button" id="btn_delete_tmp" class="btn btn-danger" data-dismiss="modal"><span id="f_delete_tmp" style="display: none;"></span>Xóa ngay</button>
              <button type="button" class="btn btn-primary" data-dismiss="modal">Thoát</button>
          </div>
      </div>
  </div>
</div>
<!-----------------DELETE Temporary Modal --------------------------->

<!-----------------DELETE Database --------------------------->
<div class="modal" id="myModal-list-delete">
  <div class="modal-dialog">
      <div class="modal-content">
          <!-- Modal Header -->
          <div class="modal-header">
              <h4 class="modal-title">Thông báo</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <!-- Modal body -->
          <div class="modal-body">
              Bạn có muốn xóa <span id="f_delete_name"></span> không?
          </div>
          <!-- Modal footer -->
          <div class="modal-footer">
              <button type="button" id="delete_database_product" class="btn btn-danger" data-dismiss="modal"><span id="f_delete" style="display: none;"></span>Xóa ngay</button>
              <button type="button" class="btn btn-primary" data-dismiss="modal">Thoát</button>
          </div>
      </div>
  </div>
</div>
<!-----------------DELETE Database--------------------------->
<!-------------------------------------- The Modal -------------------------------------------------->

<script src="/public/ckeditor/ckeditor.js"></script>
<script>CKEDITOR.replace('content');</script>
<script>CKEDITOR.replace('contents');</script>

<script>

    function addFunction(e) {
      document.getElementById(e).classList.toggle("show_add_btn");
    }

    $(document).ready(function(){
      $('#upload_img').on('submit', function(e){
        e.preventDefault();
        let data = new FormData(this);
        data.append('content', CKEDITOR.instances['content'].getData());
        $.ajax({
                url: 'upload_file',
                type: 'POST',
                data: data,
                cache: false,
                processData: false,
                contentType: false,
                success: function (result) {
                  alert(result);
                  if(result=="ok")
                  {
                    $("#upload_img").trigger("reset");//reset form
                    CKEDITOR.instances['content'].setData('');
                  }
                }
        });
        return false;
      }); 
      
      $('#e_upload_img').on('submit', function(e){
        e.preventDefault();
        console.log("ok");
        // let data = new FormData(this);
        // data.append('content', CKEDITOR.instances['content'].getData());
        // $.ajax({
        //         url: 'upload_file',
        //         type: 'POST',
        //         data: data,
        //         cache: false,
        //         processData: false,
        //         contentType: false,
        //         success: function (result) {
        //           alert(result);
        //           if(result=="ok")
        //           {
        //             $("#upload_img").trigger("reset");//reset form
        //             CKEDITOR.instances['content'].setData('');
        //           }
        //         }
        // });
        // return false;
      }); 

      $('.edit_product').on('click', function(e){
        e.preventDefault();
        $('#show_imgs').html('');
        $('#e_img').val('');
        $('#e_imgs').val('');
        let e_product = $.parseJSON($.trim($(this).find('span').text()));
        $('#e_TYPE').val(e_product.TYPE);
        $('#e_Group').val(e_product.Group);
        $('#e_name').val(e_product.name);
        $('#e_price').val(e_product.price);
        $('#e_quantity').val(e_product.quantity);
        $('#show_img').html(`<img src="/public/uploads/uploads/`+e_product.img+`" alt="`+e_product.img+`" style='border: 2px solid black;'>`);
        e_product.imgs.forEach(element => {
        $('#show_imgs').append(`<button class="show_img">
                                  <img src="/public/uploads/uploads/`+element+`" alt="`+element+`"style='border: 2px solid black;'>
                                  <i class="fa fa-times btn1" style="font-size:24px; color: rgb(151, 14, 14);"></i>
                                </button>`);
        });
        CKEDITOR.instances['contents'].setData($.parseJSON($.trim($(this).find('span').html())).description);//get html for ckedditor
        $("#myModaledit").modal('show');
      });
      
      $('.delete_product_tmp').on('click', function(e){
        e.preventDefault();
        let delete_product = $.parseJSON($.trim($(this).find('span').text()));
        $('#f_delete_name_tmp').text(delete_product.name);
        $('#f_delete_tmp').text(delete_product._id);
        $("#myModal-delete-tmp").modal('show');
      });

      $('#btn_delete_tmp').on('click', function(e){
        e.preventDefault();
        id = $(this).find('span').text();
        $.ajax({
          url: 'update_status_product',
          type: 'POST',
          data: {id: id},
          success: function (result) {
            alert(result);
            window.location.href = 'list_categories'; //chuyen trang
          }
        });
        return false;
      });

      $('.list_delete_product').on('click', function(e){
        e.preventDefault();
        let list_delete_product = $.parseJSON($.trim($(this).find('span').text()));
        $('#f_delete_name').text("vĩnh viễn " + list_delete_product.name);
        $('#f_delete').text(list_delete_product._id);
        $("#myModal-list-delete").modal('show');
      });

      $('#delete_database_product').on('click', function(e){
        e.preventDefault();
        id = $(this).find('span').text();
        $.ajax({
          url: 'delete_product',
          type: 'POST',
          data: {id: id},
          success: function (result) {
            alert(result);
            window.location.href = 'list_categories/list_delete'; //chuyen trang
          }
        });
        return false;
      });

      $('.restore_product').on('click', function(e){
        e.preventDefault();
        id = $.parseJSON($.trim($(this).find('span').text()));
        $.ajax({
          url: 'restore_product',
          type: 'POST',
          data: {id: id},
          success: function (result) {
            alert(result);
            window.location.href = 'list_categories/list_delete'; //chuyen trang
          }
        });
        return false;
      });

    });

</script>